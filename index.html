<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <title>Ping√ºiCartas: Mensajer√≠a Polar üêßüíå</title>
    <meta name="description" content="Env√≠a cartas m√°gicas con nuestro ping√ºino cartero. ¬°Crea tu PDF y comp√°rtelo!">
    <meta property="og:title" content="Ping√ºiCartas üêß">
    <meta property="og:description" content="¬°Tengo un mensaje especial para ti entregado por un ping√ºino!">
    <meta property="og:type" content="website">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        :root {
            --rosa: #ff6fb0;
            --azul-claro: #a8e6ff;
            --azul-oscuro: #2c3e50;
            --nieve: #ffffff;
        }

        /* Modo Noche Autom√°tico (8 PM a 7 AM) */
        body.night-mode {
            background: linear-gradient(#1a2a6c, #b21f1f, #fdbb2d);
            --nieve: #e0e0e0;
        }

        body {
            margin: 0;
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(var(--azul-claro), #ffffff);
            text-align: center;
            overflow-x: hidden;
            min-height: 100vh;
            transition: background 1s ease;
        }

        header {
            background: linear-gradient(90deg, #ff8fc7, #ffcce6);
            color: white;
            padding: 25px;
            font-size: clamp(20px, 5vw, 32px);
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        /* Editor Pro */
        #editor {
            margin: 20px auto;
            max-width: 600px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(10px);
            border-radius: 30px;
            transition: opacity 0.8s;
        }

        textarea {
            width: 90%;
            height: 120px;
            border-radius: 20px;
            border: 3px solid white;
            padding: 15px;
            font-size: 16px;
            outline: none;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }

        /* Selector de Sellos */
        .seccion-sellos { margin: 15px 0; }
        .sello-btn {
            font-size: 25px;
            cursor: pointer;
            padding: 10px;
            display: inline-block;
            transition: transform 0.2s;
            border: 2px solid transparent;
            border-radius: 50%;
        }
        .sello-btn.selected {
            border-color: var(--rosa);
            background: white;
            transform: scale(1.2);
        }

        button {
            width: 85%;
            max-width: 300px;
            padding: 15px;
            margin: 10px;
            border: none;
            border-radius: 50px;
            background: var(--rosa);
            color: white;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(255, 111, 176, 0.3);
        }

        /* Escenario */
        #escenario {
            height: 280px;
            position: relative;
            border-bottom: 6px solid white;
        }

        #pinguinoContainer {
            position: absolute;
            left: 5%;
            top: 130px;
            font-size: 75px;
            transition: left 3.5s cubic-bezier(0.45, 0.05, 0.55, 0.95);
            display: flex;
            align-items: center;
            z-index: 5;
        }

        #selloEnSobre {
            position: absolute;
            font-size: 25px;
            left: 60px;
            top: 25px;
        }

        #buzon {
            position: absolute;
            right: 8%;
            top: 130px;
            font-size: 70px;
        }

        .caminar { left: calc(92% - 100px) !important; }
        .pasos { animation: waddle 0.5s infinite ease-in-out; }

        @keyframes waddle {
            0% { transform: translateY(0) rotate(-6deg); }
            50% { transform: translateY(-12px) rotate(0deg); }
            100% { transform: translateY(0) rotate(6deg); }
        }

        /* Resultado Final */
        #cartaFrame {
            display: none;
            background: #fffef5;
            width: 90%;
            max-width: 500px;
            margin: 20px auto;
            padding: 30px;
            border-radius: 5px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            font-family: 'Georgia', serif;
            border-left: 8px solid var(--rosa);
            animation: slideUp 0.8s ease;
        }

        @keyframes slideUp { from { opacity: 0; transform: translateY(30px); } }

        .copo { position: fixed; top: -10px; color: white; user-select: none; pointer-events: none; z-index: 1; }
    </style>
</head>
<body>

<header>Ping√ºiCartas Pro üêß‚ùÑÔ∏è</header>

<div id="editor">
    <h3>1. Escribe tu mensaje</h3>
    <textarea id="textoCarta" placeholder="Querido/a..."></textarea>
    
    <h3>2. Elige un sello</h3>
    <div class="seccion-sellos">
        <span class="sello-btn selected" onclick="cambiarSello(this, '‚ù§Ô∏è')">‚ù§Ô∏è</span>
        <span class="sello-btn" onclick="cambiarSello(this, '‚≠ê')">‚≠ê</span>
        <span class="sello-btn" onclick="cambiarSello(this, 'üçÄ')">üçÄ</span>
        <span class="sello-btn" onclick="cambiarSello(this, 'üéÄ')">üéÄ</span>
    </div>
    
    <button onclick="enviarCarta()">¬°Entregar Mensaje! ‚û°Ô∏èüìÆ</button>
</div>

<div id="escenario">
    <div id="pinguinoContainer">
        <span>üêß</span>
        <span id="sobreVisual">‚úâÔ∏è<span id="selloEnSobre">‚ù§Ô∏è</span></span>
    </div>
    <div id="buzon">üìÆ</div>
</div>

<div id="cartaFrame">
    <div id="selloFinal" style="font-size: 40px; margin-bottom: 10px;">‚ù§Ô∏è</div>
    <div id="contenidoTexto"></div>
</div>

<div id="botonesFinales" style="display:none; padding-bottom: 50px;">
    <button onclick="descargarPDF()" style="background: #4ab3ff;">Descargar PDF Pro üìÑ</button>
    <button onclick="compartir()" style="background: #25D366;">Compartir / WhatsApp üì≤</button>
    <button onclick="location.reload()" style="background: #999;">Crear Otra</button>
</div>

<script>
    let selloSeleccionado = "‚ù§Ô∏è";

    // --- MODO NOCHE ---
    const hora = new Date().getHours();
    if (hora >= 20 || hora < 7) document.body.classList.add('night-mode');

    // --- NIEVE ---
    setInterval(() => {
        const copo = document.createElement("div");
        copo.className = "copo";
        copo.innerHTML = "‚ùÑÔ∏è";
        copo.style.left = Math.random() * 100 + "vw";
        copo.style.fontSize = Math.random() * 15 + 10 + "px";
        const d = Math.random() * 3 + 4;
        copo.style.transition = `top ${d}s linear`;
        document.body.appendChild(copo);
        setTimeout(() => { copo.style.top = "110vh"; }, 100);
        setTimeout(() => { copo.remove(); }, d * 1000);
    }, 350);

    function cambiarSello(elemento, emoji) {
        document.querySelectorAll('.sello-btn').forEach(b => b.classList.remove('selected'));
        elemento.classList.add('selected');
        selloSeleccionado = emoji;
        document.getElementById('selloEnSobre').innerText = emoji;
        document.getElementById('selloFinal').innerText = emoji;
    }

    function enviarCarta() {
        const t = document.getElementById("textoCarta").value;
        if(!t.trim()) return alert("¬°Escribe algo primero!");

        // Vibraci√≥n (solo en Android)
        if(navigator.vibrate) navigator.vibrate(100);

        document.getElementById("editor").style.display = "none";
        const pingui = document.getElementById("pinguinoContainer");
        pingui.classList.add("pasos", "caminar");

        setTimeout(() => {
            document.getElementById("sobreVisual").style.opacity = "0";
            document.getElementById("buzon").innerHTML = "üì¨";
            pingui.classList.remove("pasos");
        }, 3500);

        setTimeout(() => {
            document.getElementById("contenidoTexto").innerHTML = t.replace(/\n/g, '<br>');
            document.getElementById("cartaFrame").style.display = "block";
            document.getElementById("botonesFinales").style.display = "block";
            document.getElementById("cartaFrame").scrollIntoView({ behavior: 'smooth' });
        }, 4200);
    }

    // --- COMPARTIR ---
    async function compartir() {
        const t = document.getElementById("textoCarta").value;
        if (navigator.share) {
            try {
                await navigator.share({
                    title: 'Ping√ºiCarta para ti',
                    text: `üêßüíå Mensaje: ${t}`,
                    url: window.location.href
                });
            } catch (err) {}
        } else {
            // Fallback para WhatsApp si no hay share api
            window.open(`https://wa.me/?text=Tengo una Pinguicarta para ti: ${t}`);
        }
    }

    // --- PDF MULTI-P√ÅGINA ---
    function descargarPDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        let t = document.getElementById("textoCarta").value;
        const tLimpio = t.replace(/([\u2700-\u27BF]|[\uE000-\uF8FF]|\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDFFF]|[\u2011-\u26FF]|\uD83E[\uDD10-\uDDFF])/g, '');

        function decoracion(p) {
            p.setDrawColor(255, 111, 176);
            p.rect(10, 10, 190, 277);
            p.setFont("helvetica", "bold");
            p.setFontSize(20);
            p.text("Pinguicarta Pro", 105, 25, { align: "center" });
        }

        decoracion(doc);
        doc.setFont("times", "italic");
        doc.setFontSize(14);
        
        const lineas = doc.splitTextToSize(tLimpio, 160);
        let y = 45;

        lineas.forEach(l => {
            if(y > 260) { doc.addPage(); decoracion(doc); y = 40; doc.setFont("times", "italic"); }
            doc.text(l, 25, y);
            y += 8;
        });

        doc.setFont("helvetica", "normal");
        doc.setFontSize(10);
        doc.setTextColor(150);
        doc.text("Enviado con amor desde el Polo Norte virtual", 105, 282, { align: "center" });
        
        doc.save("Pinguicarta_Final.pdf");
    }
</script>

</body>
</html>